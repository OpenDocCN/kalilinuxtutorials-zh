# PCFG 破解程序:概率上下文无关语法(PCFG)密码猜测生成器

> 原文：<https://kalilinuxtutorials.com/pcfg/>

[![PCFG Cracker : Probabilistic Context Free Grammar (PCFG) Password Guess Generator](img//369675593fb345e8ee3dc725e15f5b1b.png "PCFG Cracker : Probabilistic Context Free Grammar (PCFG) Password Guess Generator")](https://1.bp.blogspot.com/-aUh2DTPaGfk/XjxGrzokaRI/AAAAAAAAEvg/x6QvbOGdDCsJ2ClE6AsjRbsi-nC7aASJQCLcBGAsYHQ/s1600/Cracking%2BAlgorithm%25281%2529.png)

这个项目使用机器学习来识别用户的密码创建习惯。PCFG 模型是通过对一系列公开的明文/破解密码进行训练而生成的。在这个项目的上下文中，这个模型被称为一个规则集，它包含在训练过程中识别的密码的许多不同部分，以及它们相关的概率。

这种词干分析对于 PRINCE 等其他破解工具也很有用，并且/或者规则集的某些部分可以直接整合到更传统的基于字典的攻击中。这个项目还包括一个 PCFG 猜测生成器，它利用这个规则集按照概率顺序生成密码猜测。

这比标准的字典攻击要强大得多，并且在测试中已经证明能够以比其他公开可用的方法少得多的猜测来平均破解密码。

缺点是按概率顺序生成猜测很慢，这意味着它平均每秒钟生成 5-10 万次猜测，而基于 GPU 的算法与快速哈希算法相比，每秒钟可以生成数百万到数十亿次(甚至更多)的猜测。

因此，PCFG 猜测器最适合用于大量加盐哈希或其他慢速哈希算法，其中算法的性能成本由猜测的准确性来弥补。

*   PCFG——概率上下文无关语法
*   PCFG——非常酷的模糊猜测者

简而言之:研究人类如何生成密码的工具集。这些可以用来破解密码哈希，也可以创建合成密码(蜜语)，或者帮助开发更好的密码强度算法。

**也可阅读-[S3 enum:用于 Pentesters](https://kalilinuxtutorials.com/s3enum/)T3 的快速亚马逊 S3 桶枚举工具**

**要求&安装**

*   Python3 是这些工具唯一的硬性要求
*   强烈推荐安装 chardet python3 库用于训练。虽然不是必需的，但它会对训练密码执行字符编码自动检测。要安装它:
*   从[https://pypi.python.org/pypi/chardet](http://https://pypi.python.org/pypi/chardet)下载源代码
*   或者使用`pip3 install chardet`进行安装

**快速入门指南**

**训练**

此报告中包含的默认规则集是通过对 RockYou 数据集的一百万个密码子集进行训练而创建的。通过对 RockYou 的全部 3200 万个密码集进行训练，可以获得更好的性能，但为了保持较小的下载量，排除了这一点。

您可以使用默认规则集开始生成密码，而不必在新列表上训练，但建议在可能更接近您尝试的目标的目标密码集上训练。如果您创建了自己的规则集，这里有一个快速指南:

*   确定一组明文密码进行训练。
    *   该密码集应包含重复的密码。这样，培训师可以识别常见的密码，如 123456。
    *   密码应该是明文，带有哈希和相关的信息，比如用户名。不要尝试使用 raw。pot 文件作为你的训练集作为哈希值将被训练程序视为密码的一部分。
    *   密码的编码方式应该与您希望生成密码猜测值的方式相同。因此，如果您想要创建 UTF-8 密码猜测，训练集也应该编码为 UTF-8。从长远来看，在生成猜测时修改它的能力已经在开发计划中了，但是目前还不支持这个特性。
    *   训练密码列表应该在 100k 到 5000 万之间。关于训练密码列表的大小如何影响猜测生成的测试仍在进行中，即使密码列表小到 10k，也取得了很好的成功，但理想的大小可能是 100 万左右，之后收益递减。
    *   出于本教程的目的，输入密码列表将被称为输入密码列表

*   为生成的规则集选择一个名称。出于本教程的目的，它将是 NEW_RULESET
*   在输入密码列表上运行训练器
    *   `**python3 trainer.py -t INPUT_PASSWORD_LIST -r NEW_RULESET**`
    *   常见可选标志:a. **覆盖率**:你有多信任训练集匹配目标密码。更高的覆盖率意味着使用较少的智能蛮力生成，使用马尔可夫模型(目前使用 OMEN 算法)。如果您将覆盖范围设置为 1，则不会执行暴力破解。如果您将覆盖率设置为 0，它将仅使用马尔可夫攻击生成猜测。该值是一个浮点数，默认值为 0.6，这意味着它预计有 60%的机会可以在训练集中找到目标密码的基本单词。示例:`**python3 trainer.py -t INPUT_PASSWORD_LIST -r NEW_RULESET -c 0.6**`b .**–save _ sensitive**:如果指定此项，则训练中发现的电子邮件地址和完整网站等敏感数据将保存在规则集中。虽然 PCFG 猜测生成器目前不使用这些数据，但在真正的密码破解攻击中，这些数据非常有价值。默认情况下，该选项处于关闭状态，以便在学术环境中更容易使用该工具。请注意，即使关闭此选项，几乎肯定仍会有 PII 数据保存在规则集内，因此请适当保护生成的规则集。示例:`**python3 trainer.py -t INPUT_PASSWORD_LIST -r NEW_RULESET --save_sensitive**`c .**–注释**:向规则集配置文件添加注释。这很有用，这样当你回头看的时候，你就知道为什么以及如何生成你的规则集。在引号中包含您要添加的注释。

**猜代**

这将使用先前训练的 PCFG 规则集生成对 stdout 的猜测。这些猜测可以通过管道传输到任何你想使用它们的程序中。如果未指定规则集，将使用默认规则集 **DEFAULT** 。出于本指南的目的，将假设正在使用的规则集是**新规则集**。

*   注意:指定规则集名称时，猜测生成程序区分大小写。
    *   会话名称不是必需的，(默认情况下，它将创建一个名为 **default_run** 的会话)，但是它有助于更容易地重新启动暂停/停止的会话。这些例子将使用会话名**会话名**。请注意，如果您同时使用相同的名称运行多个会话，则没有内置的健全性检查，但是建议避免这种情况。

*   要开始新的猜测会话运行:
    *   `**python3 pcfg_guesser.py -r NEW_RULESET**` -s 会话名称
*   要重新开始之前的猜测会话运行:
    *   `**python3 pcfg_guesser.py -s SESSION_NAME --load**`

**密码强度评分**

在许多情况下，您可能希望估计由先前训练的规则集生成密码的概率。例如，这可能是密码强度指标的一部分，或者用于其他研究目的。包含了一个示例程序来执行此操作。

*   INPUT_LIST 表示要评分的密码列表。这些密码应该是明文，用换行符隔开，每行一个密码。
*   要运行评分会话:`**python3 password_scorer -r NEW_RULESET -i INPUT_LIST**`
*   默认情况下。它会将结果输出到 stdout，每行记录一个密码
    *   第一个值是原始密码
    *   第二个值将表示输入值是否为“密码”、“网站”、“电子邮件地址”或“其他”。密码或其他的确定取决于您为预兆猜测限制设置的限制，以及与 PCFG 关联的概率。
    *   第三个值是根据规则集密码的概率。如果它被赋值为 0.0，这意味着密码不会由规则集生成，尽管它可能由基于马尔可夫的攻击生成
    *   第四个值是将生成密码的预兆级别。值-1 表示 OMEN 不会生成密码。

**Prince-Ling 字表生成器**

* *名称:* *太子语 Idexed N-Grams(太子-凌)

*   **概述:**基于已经训练好的 PCFG 规则集/语法构建定制的单词表，用于王子风格组合子攻击。这背后的想法是，由于 PCFG 训练者已经将训练设置密码分解为单独的解析，这些信息可以用来为其他攻击制作有针对性的单词列表。
*   基础力学:在引擎盖下，Prince-Ling 工具基本上是一个迷你 PCFG 猜想生成器。它去掉了马尔可夫猜测生成，用一个为生成 PRINCE 单词表而定制的显著简化的基础结构代替了普通 PCFG 攻击中使用的基础结构。这允许以概率顺序生成字典单词，着眼于这些单词在 PRINCE 攻击中的预期有用程度。

**利用太子——凌**

*   使用 trainer.py 训练 PCFG 规则集。注意，您需要使用 PCFG 工具集的 4.1 或更高版本创建规则集，因为早期版本无法学习 Prince-Ling 使用的所有数据结构。
*   跑太子——凌`**python3 prince-ling.py -r RULESET_NAME -s SIZE_OF_WORDLIST_TO_CREATE -o OUTPUT_FILENAME**`
    *   **–rule**:用于创建王子单词列表的 PCFG 规则集的名称
    *   **–size**:为王子词表创建的字数。注意，如果没有指定，Prince-Ling 将生成所有可能的单词，这些单词可能很大，这取决于是否启用了 case_mangling。(案例处理增加了足够的密钥空间)
    *   **–输出**:输出要写入入口的文件名。注意，如果没有指定，Prince-Ling 将向 stdout 输出单词，这可能会导致问题，具体取决于打印非 ASCII 字符时使用的 shell。
    *   **–all _ lower**:只为王子词典生成小写单词。当攻击不区分大小写的散列时，或者如果您计划以不同的方式应用目标大小写处理时，这很有用。

**使用 Joh 破解密码的示例**

**n 开膛手**

python 3 pcfg _ guesser-r NEW _ RULESET-s SESSION _ NAME |。/John–stdin–format = bcrypt PASSWORDS _ TO _ crack . txt

[**Download**](https://github.com/lakiw/pcfg_cracker)