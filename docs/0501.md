# FFM:自由战斗模式开源黑客线束

> 原文：<https://kalilinuxtutorials.com/ffm-freedom-fighting-mode/>

FFM 是一个黑客工具，你可以在红队战斗的后期开发阶段使用。

它在 [SSTIC 2018](https://www.sstic.org) 上展示，附带的幻灯片可在[的这个 url](http://manalyzer.org/static/talks/SSTIC2018.pptx) 上获得。

如果您不熟悉这类工具，强烈建议您看一看它们，以了解黑客工具的用途。所有评论都包含在幻灯片中。

**同时阅读-[期末作业论文写作技巧](https://kalilinuxtutorials.com/tips-for-paper-writing-for-final-assignment/)**

**用途**

黑客工具的目标是充当一个助手，在后期开发阶段自动执行常见任务，但也保护用户免受他们可能犯的错误。

它是外壳的一个仪器。运行`**./ffm.py**`激活它，你可以立即开始工作。您需要了解两个命令:

*   键入`**!list**`显示线束提供的命令。
*   键入`**SHIFT+TAB**`在本地机器上执行 tab 补全。如果您通过 ssh 登录到远程计算机，但需要引用位于您的机器上的文件，这可能会很有用。

**功能列表**

这个黑客工具提供了下面描述的一些特性。正如所描述的那样，还将介绍该工具背后的设计理念。

并不是所有在 FFM 实现的命令都会适合你。每个人都有自己的做事方式，根据自己的特定需求调整工具可能需要您修改一些代码和/或编写一些插件。

为了确保这是一项轻松的任务，我们付出了很多努力。

**命令**

*   `!os`是一个非常简单的命令，它只运行`cat /etc/*release*`来显示当前机器正在运行什么操作系统。最有价值的演示可能是，在黑客工具的上下文中，您可以定义跨机器边界工作的别名。SSH 进入任何一台计算机，键入`!os`，命令就会运行。这个插件位于`commands/replacement_commands.py`，当你想学习编写插件时，它是一个很好的起点。
*   从远程机器获取文件，并通过终端复制到本地。这个命令稍微复杂一点，因为需要更严格的错误检查，但是它是另一个你可以很容易阅读的插件。你可以在`commands/download_file.py`里找到。注意，它需要远程机器上的`xxd`或`od`才能正常工作。
*   `!upload [local file] [remote path]`与前面的命令完全相同，除了本地文件放在远程机器上。
*   会产生 TTY，这在大多数情况下是你不希望看到的，因为它会留下法医证据。然而，一些命令(`sudo`)或漏洞需要 TTY 来运行，所以这是为了方便而提供的。`UNSET HISTFILE`一产卵就传给它。
*   `!py [local script]`在远程机器上执行本地 Python 脚本，并且完全在内存中执行*。查看我的[其他资源库](https://github.com/JusticeRage/freedomfighting)中可能会用到的脚本。这个命令使用了带有`<<`的多行语法，这意味着不支持它的伪 shell(Weevely 就是一个很好的例子)会严重破坏这个命令。*

 *可以通过编辑`ffm.conf`进一步配置插件。

**处理器**

从概念上讲，命令(如上所述)用于生成一些 bash，然后转发给 shell。

它们可以通过捕获 shell 的输出并根据返回的内容生成附加指令来执行更复杂的操作。处理器略有不同，因为它们更常用于重写在用户和底层 bash 进程之间循环的数据。

虽然任何处理器都可以被重写为一个命令，但是将两者分开似乎更清楚一些。一旦用户按下`ENTER`键，输入处理器就会处理用户输入的任何内容，输出处理器可以修改 shell 返回的任何内容。

*   在`**processors/ssh_command_line.py**`中可以找到一个很好的处理器示例。它所做的就是将`-T`选项添加到它发现的任何 SSH 命令中，如果它丢失了的话。如果您对编写处理器感兴趣，请务必查看它的简单代码。
*   框架中存在的另一个输入处理器`**processors/assert_torify.py**`，包含一个网络命令的黑名单(`ssh`、`nc`)，如果它们似乎没有通过`torify`之类的工具进行代理，就会阻止它们。如果命令看起来是在本地机器上运行的话，这个工具会尽力不打扰用户。显然，这不应该是你防止泄露家庭 IP 地址的唯一保障。
*   最后，`**processors/sample_output_processor.py**`是一个非常简单的输出处理器，它用红色突出显示任何出现的单词“password”。因为它没什么用，所以在框架中没有启用，但是如果你想做一些更复杂的事情，你仍然可以把它作为一个起点。

**已知问题**

尚未实施，我们都非常想念它。

目前没有办法在远程机器的内存中运行 elf。这是待办事项中的头等大事。

更成问题的是，框架时不时会挂起。在 99%的情况下，当它未能检测到它启动的命令已经完成运行时，就会发生这种情况。

通常，这意味着您登录的机器的命令提示符不能被识别。

在这种情况下，您可以尝试改进位于文件`ffm.py`最开头的正则表达式，或者使用`ssh -T`登录到同一台机器，因为不会再有任何有问题的提示。

默认情况下，FFM 会在 5 分钟后放弃尝试读取一个命令的输出(有些插件可能会实现不同的超时)；因此，如果框架挂起，您需要等到看到错误消息(尽管如果底层进程仍在运行，您可能仍然无法输入命令)。

[**Download**](https://github.com/JusticeRage/FFM)*