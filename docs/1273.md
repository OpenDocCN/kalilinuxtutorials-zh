# 寒鸦:收集收集收集

> 原文：<https://kalilinuxtutorials.com/jackdaw/>

Jackdaw 在这里收集您的域中的所有信息，将其存储在 SQL 数据库中，并向您展示您的域对象如何相互交互以及潜在攻击者如何利用这些交互的精美图表。它还附带了一个方便的功能，通过存储/查找/报告哈希/密码/用户来帮助您进行密码破解项目。

**示例命令**

除了数据库 init 之外，这些命令中的大多数已经可以从 webapi 中获得。

*   **数据库初始化**

`**jackdaw --sql sqlite:///<full path here>/test.db dbinit**`

*   **枚举**
    *   **集成 sspi 的完全枚举–仅 windows】**

`**jackdaw --sql sqlite:///test.db enum 'ldap+sspi://10.10.10.2' 'smb+sspi-ntlm://10.10.10.2'**`

通行证是 **`Passw0rd!`
`jackdaw --sql sqlite:///test.db enum 'ldap://TEST\victim:Passw0rd!@10.10.10.2' 'smb+ntlm-password://TEST\victim:Passw0rd!@10.10.10.2'`**

*   使用用户名和密码的仅 LDAP 枚举–独立于平台

通行证是 **`Passw0rd!`
`jackdaw --sql sqlite:///test.db ldap 'ldap://TEST\victim:Passw0rd!@10.10.10.2'`**

*   启动交互式 web 界面来绘制图形和访问附加功能

`**jackdaw --sql sqlite:///<FULL PATH TO DB> nest**`

*   打开 API 的`http://127.0.0.1:5000/ui`
*   请参见下面的`**Building the UI**`部分，了解如何构建 UI。一旦建成:
*   打开`**http://127.0.0.1:5000/nest**`进入图形界面(显示图形，但远不能工作)

**也可以理解为-[AWS px:一个基于图形的可视化有效访问工具](https://kalilinuxtutorials.com/awspx/)**

**特性**

**数据采集**

*   **通过 LDAP**

LDAP 枚举阶段获取有关 AD 信息、用户、机器、OU、组对象的数据，这些对象将被表示为图形中的一个节点，以及数据库中的一个单独的表。此外，将解析所有上述对象的安全描述符，并将 DACL 的 ACL 添加到数据库中。这与成员信息一起将被表示为 garph 中的边。此外，在需要时，可以对前面提到的任何数据类型执行定制 SQL 查询。

*   **通过 SMB** 实现

SMB 枚举阶段通过连接到域中的每台计算机(通过 LDAP 获取)来获取有关共享、本地组、会话和 NTLM 数据的数据

*   **通过 LSASS 转储(可选)**

该框架允许用户上传 LSASS 内存转储来存储凭证和扩展会话信息表。这两条边都将用作图中的附加边(分别是共享密码和会话)。该框架还使用该信息来创建关于弱/共享/破解凭证的密码报告。

*   **通过数据同步结果(可选)**

该框架允许用户上传 impacket 的 DCSYNC 文件来存储凭证。这被用作图中的附加边(共享密码)。该框架还使用该信息来创建关于弱/共享/破解凭证的密码报告。

*   **通过手动上传(可选)**

该框架允许在各个方面手动扩展可用的数据库。示例:当发现给定计算机上的用户会话信息时(在自动枚举之外)，可以手动上传这些会话，这将填充数据库以及结果图

**图形**

该框架可以使用数据库中的可用信息生成一个图形，并通过 web UI (nest)绘制它。此外，可以通过使用 web API (/ui 端点)或 graph 对象的函数，以编程方式调用图形生成和路径取消。

**异常检测**

该框架可以在不生成图形的情况下识别常见的广告误配置。目前仅通过 web API。

*   **用户**

用户异常检测包括检测不安全的 UAC 权限和大量用户描述值。随着新功能的实现，该功能集有望在未来得到扩展。

*   **机器**

机器异常检测包括检测不安全的 UAC 权限、非强制性 SMB 登录、过时的操作系统版本、域外机器。随着新功能的实现，该功能集有望在未来得到扩展。

**密码破解**

该框架不执行任何破解，只组织哈希和破解结果，目前主要关注的是 impacket 和 aiosmb 的 dcsync 结果！仅 NT 和 LM 哈希！

*   **样本流程如下:**
    *   通过 impacket/aiosmb 以文本文件的形式获取凭证，或者通过您认为合适的任何工具以 LSASS 进程的内存转储的形式获取凭证。
    *   通过 API 上传获取的凭证
    *   通过 API 轮询未破解的 hases
    *   破解它们(hashcat？)
    *   通过 API 将结果上传到框架
    *   生成关于已破解/未破解用户、密码强度和密码共享的报告

注:这个特性是为攻击者和防御者实现的。就我个人而言，我看不出任何一方有多大的附加价值，因为在这一点上，人们获得了用户的 nt 散列，它就像密码一样好……尽管如此，越来越多的公司正在进行密码强度练习，这一特性将有助于他们。至于攻击者:它只是在这一点上炫耀，但我的客人。可能吓唬管理层加分。

**重要**

这个项目是在实验阶段！这意味着很多事情:

*   它可能会崩溃
*   您正在使用的控件将来可能会改变(很有可能)
*   (最糟糕的部分)数据库设计不一定适合未来的要求，所以它可能会改变。将不会努力维护与实验阶段数据库结构的向后兼容性！

**技术部分**

*   **数据库后端**

Jackdaw 使用 SQLAlchemy ORM 模块，它让您可以选择使用任何您喜欢的 SQL DB 后端。由于种种原因，测试主要是在 SQLite 上进行的。在这个项目中不会使用任何后端特定的命令来限制你。

*   **构建用户界面**

只有通过 GIT 安装和/或更改 UI 代码时，才需要这样做

UI 是用 React 编写的。在第一次使用/安装之前，您必须构建它。为此，您需要安装`**nodejs**`和`**npm**`。然后:

*   转到`**jackdaw/nest/site/nui**`
*   运行`**npm install**`
*   运行`**npm run build**`

完成上述操作后，用户界面就可以使用了。

[**Download**](https://github.com/skelsec/jackdaw)