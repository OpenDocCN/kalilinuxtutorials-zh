# Regexploit:查找易受 ReDoS(正则表达式拒绝服务)攻击的正则表达式

> 原文：<https://kalilinuxtutorials.com/regexploit/>

[![Regexploit : Find Regular Expressions Which Are Vulnerable To ReDoS (Regular Expression Denial Of Service)](img//7ebba58db5a92a93900857782603cb1f.png "Regexploit : Find Regular Expressions Which Are Vulnerable To ReDoS (Regular Expression Denial Of Service)")](https://1.bp.blogspot.com/-SA0oGqdoFmk/YPgGnYlmnfI/AAAAAAAAKJU/wvrMBDWXUcU-4hsghvHjzmc48cocfqxjQCLcBGAsYHQ/s1939/1%2B%25281%2529.png)

一个工具，用来查找易受正则表达式拒绝服务攻击(ReDoS)的正则表达式。

**关于** **的更多信息**

**Regexploit:可执行的正则表达式**

当想到拒绝服务(DoS)时，我们通常会关注分布式拒绝服务(DDoS)，在这种情况下，数百万台僵尸机器通过发起数据海啸来使服务过载。然而，通过滥用 web 应用程序使用的算法，攻击者只需一个请求就可以让服务器瘫痪。这样做需要找到在特定条件下表现糟糕的算法，然后触发这些条件。正则表达式(regexes)的误用是一个普遍且经常易受攻击的领域。

正则表达式用于各种文本处理任务。它们可能看起来运行良好，但是如果正则表达式容易受到正则表达式拒绝服务(ReDoS)的攻击，就有可能手工输入导致 CPU 多年 100%运行。

在这篇博文中，我们发布了一个新的工具来分析正则表达式并寻找 ReDoS 漏洞。我们的启发式方法已经被证明是非常有效的，正如在流行的 NPM、Python 和 Ruby 依赖中发现的许多漏洞所证明的那样。

**用 Regexploit 检查你的正则表达式**

[@ doyensec/regexploit](https://github.com/doyensec/regexploit)–`**pip install regexploi**t`然后找一些 bug。

许多默认的正则表达式解析器具有无限的最坏情况复杂性。当出现匹配的输入字符串时，正则表达式匹配可能会很快。但是，某些不匹配的输入字符串可能会使正则表达式匹配器陷入疯狂的回溯循环，并且需要很长时间来处理。这可能导致拒绝服务，因为 CPU 将无法匹配正则表达式。

该工具旨在:

*   找到容易被重做的正则表达式
*   举一个会导致灾难性回溯的恶意字符串的例子

**最坏情况复杂度**

这反映了正则表达式匹配器关于输入字符串长度的回溯过程的复杂性。

这里的立方复杂性意味着，如果字符串中易受攻击的部分长度加倍，执行时间应该是原来的 8 倍(2^3).对于带星号的指数重做，例如`(a*)*$`，使用了一个模糊因子，复杂度将大于 10。

对于可开发性，通常需要立方复杂度或更高的复杂度，除非允许真正巨大的字符串作为输入。

**例子**

运行`**regexploit**`，在命令行输入正则表达式 **`v\w*_\w*_\w*$`** 。

**$****regexploit
v \ w*\ w*\ w*$ pattern:v \ w \ w \ w*$
最坏情况复杂度:3 ⭐⭐⭐(立方)
重复字符:[5f: *]导致回溯的最终字符:[^WORD]例如:' v' + '* ' * 3456 +'！'**

部分`**\w*_\w*_\w***`包含三个重叠的重复组(w 匹配字母、数字 ***和下划线*** )。如第`**Repeated character: [5f:_]**`行所示，一长串`_` (0x5f)会以许多不同的方式匹配这个部分。最坏情况的复杂度是 3，因为有 3 个无限重复的组。给出了一个引起 ReDoS 的例子:它由所需的前缀`v`、一长串`_`和一个`!`(非词字符)组成，以引起回溯。并不是所有的重做都要求最后有一个特定的字符，但是在这种情况下，一长串的`_`将会成功地匹配正则表达式，并且不会回溯。第`**Final character to cause backtracking: [^WORD]**`行显示末尾需要一个不匹配的字符(不是单词字符)来防止匹配并导致重做。

再比如，安装一个容易被重做的模块版本，比如`**pip install ua-parser==0.9.0**`。要扫描已安装的 python 模块，运行 **`regexploit-python-env`。**

**导入 ua_parser.user_agent_parser
在/somewhere/中易受攻击的 regex。env/lib/python 3.9/site-packages/ua _ parser/user _ agent _ parser . py # 183
pattern:\ bsmartwatch *(*([^；]+) *;*([^;]+) *;
context:self . user _ agent _ re = re . compile(self . pattern)
最坏情况复杂度:3 ⭐⭐⭐
重复字符:[20]
示例:'智能手表('+ ' ' * 3456
最坏情况复杂度:3 ⭐⭐⭐
重复字符:[20]
示例:'智能手表(0；'+ ' ' * 3456
易受攻击的正则表达式在/某处/。env/lib/python 3.9/site-packages/ua _ parser/user _ agent _ parser . py # 183
Pattern:；*(【^；/]+)构建[/]huawei(mt1-u06|[a-z]+\d+[^)；]+)[^);]* )
上下文:self . user _ agent _ re = re . compile(self . pattern)
最坏情况复杂度:3 ⭐⭐⭐
重复字符:[[0-9]]
例:'；0 Build/HuaweiA' + '0' * 3456**

对于每个易受攻击的正则表达式，它打印一个或多个恶意字符串来触发重做。将您的用户代理设置为`**;0 Build/HuaweiA000000000000000...**`并使用旧版本的 ua-parser 浏览网站可能会导致服务器花费很长时间来处理您的请求，可能会以状态 502 结束。

**安装**

需要 Python 3.8+版本。要从 JavaScript / TypeScript 代码中提取正则表达式，还需要 NodeJS 12+。

可选地创建虚拟环境

**蟒蛇 3 -m venv。env
来源。环境/媒体夹/激活**

现在实际安装 pip

**pip 安装 regexploit**

**用途**

**Regexploit 带有一个正则表达式列表**

通过 stdin(每行一个)将正则表达式输入 **`regexploit`** 。

**regexploit**

或者通过文件

**cat my regex es . txt | regexploit**

**自动提取正则表达式**

内置支持解析 Python、JavaScript、TypeScript、C#、YAML 和 JSON 中的正则表达式。

**Python 代码**

通过 AST 解析 Python 代码(不执行它)来查找正则表达式。然后对正则表达式进行重做分析。

**regexploit-py my-project/
regexploit-py " my-project/**/*。py”——环球**

**Javascript /类型脚本**

这将使用`**regexploit/bin/javascript**`中捆绑的 NodeJS 包，它用 eslint 将您的 JavaScript 解析为 AST，并打印出所有的正则表达式。

这些正则表达式被输入 python ReDoS finder。

**regexploit-js my-module/my-file . js another/file . js some/folder/
regexploit-js " my-project/node _ modules/**/*。js”-环球**

**注意事项**。javascript 和 python 正则表达式解析之间存在差异，因此可能会有一些错误。我不确定我要写一个 JS 正则表达式 AST！

**Python 导入**

在当前安装在 path / env 中的所有 python 模块中搜索正则表达式。这意味着你可以`**pip install**`任何你感兴趣的模块，它们将被分析。包含 Cpython 代码。

**regeexploit-python-env**

**N.B.** 这不会将 python 代码解析为 AST，只会找到在模块导入时自动编译的正则表达式。模块实际上是导入的，**，所以模块中的代码将被执行**。这有助于查找加载时由较小字符串组成的正则表达式，例如 Pillow 中的 CVE-2021-25292

**JSON / YAML**

Yaml 支持需要 pyyaml，可以用`**pip install regexploit[yaml]**`安装。

**regexploit-json *。json
regexploit-yaml *。yaml**

**C#(。NET)**

**regexploit-cs harp something . cs**

[**Download**](https://github.com/doyensec/regexploit)